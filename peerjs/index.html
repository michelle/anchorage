<head>
  <title>Anchorage</title>
  <script type="text/javascript" src="../lib/game/player.js"></script>
  <script type="text/javascript" src="../lib/game/deck.js"></script>
  <script type="text/javascript" src="../lib/game/game.js"></script>
  <script src="http://cdn.peerjs.com/0.3/peer.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

  <script>
    // TODO: move to not here.

    // Ideally:
    // Server peer creates a room and peers connect to it.
    // Server peer info is source of truth.
    // Other peers don't even need to connect to each other to start with--can
    //   do that behind the scenes.
    // Other peers can also consolidate game state, but don't use it.
    // If server peer disconnects, next peer uses his game state.

    // Game code.
    var game = new Game();
    var me = game.join();

    // Peer code.
    var peer = new Peer({key: 'lwjd5qra8257b9'});
    var connections = [];
    peer.on('open', function(id) {
      $('#peer-id').text(id);
    });
    peer.on('error', function(err) {
      $('#error').text(err.message);
    });
    peer.on('connection', function(conn) {
      connections.push(conn);

      // Make connection join.
      // TODO: how do we make sure the players are in the correct order?
      // Server peer will have to do this.
      game.join();
      $('form').text('Connected.');
    });

    $(function() {
      $('#peer').submit(function(ev) {
        var connection = peer.connect($('#connection').val());
        connection.on('error', function(err) {
          $('#error').text(err.message);
        });
        connection.on('open', function() {
          $('form').html('<button id="start">Start game!</button>');
        });
        connections.push(connection);
        ev.preventDefault();
      });
    });
  </script>
</head>

<body>
  <h1>Anchorage demo.</h1>

  <div>
    <h2 id="peer-id"></h2>
    <form id="peer">
      <input type="text" id="connection">
      <input type="submit">
    </form>
  </div>
  <div id="error"></div>
</body>
